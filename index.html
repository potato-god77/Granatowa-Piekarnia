<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#4a3728">
    <title>Granatowa Piekarnia</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,700&family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #4a3728; --bg: #fdfaf7; --accent: #8b5e3c; --sand: #f5ece2; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--primary); margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        .serif { font-family: 'Playfair Display', serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .nav-btn { border-bottom: 3px solid transparent; transition: all 0.2s; flex-shrink: 0; color: #a89284; cursor: pointer; }
        .nav-btn.active { color: var(--primary); font-weight: 900; border-bottom: 3px solid var(--accent); }
        .glass-card { background: white; border-radius: 20px; box-shadow: 0 4px 15px rgba(74, 55, 40, 0.05); border: 1px solid #efe3d8; overflow: hidden; }
        .btn-feed.active { background-color: #e7dfd8 !important; color: #4a3728 !important; border-color: #d4c5ba !important; }
        .accordion-content { display: none; }
        .accordion-item.active .accordion-content { display: block; animation: slideDown 0.2s ease-out; }
        .accordion-item.active .plus-icon { transform: rotate(45deg); }
        .recipe-step { position: relative; padding-left: 1.2rem; margin-bottom: 0.8rem; border-left: 2px solid var(--sand); margin-left: 0.4rem; font-size: 0.9rem; line-height: 1.5; }
        
        /* Modal & Karuzela */
        #viewer-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 9999; flex-direction: column; }
        #viewer-modal.active { display: flex; }
        .carousel-track { display: flex; transition: transform 0.3s ease-out; height: 100%; }
        .carousel-slide { min-width: 100%; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .thumb-strip { display: flex; gap: 8px; overflow-x: auto; padding: 15px; background: rgba(0,0,0,0.5); }
        .thumb-item { width: 50px; height: 50px; flex-shrink: 0; border-radius: 6px; opacity: 0.5; border: 2px solid transparent; }
        .thumb-item.active { opacity: 1; border-color: white; }
        
        .brown-gradient { background: linear-gradient(135deg, #4a3728 0%, #634a38 100%); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        #lock-screen { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body class="pb-24">
    <div id="lock-screen">
        <h1 class="serif text-3xl italic mb-8 text-stone-800">Granatowa Piekarnia</h1>
        <div class="glass-card p-8 flex flex-col items-center">
            <input type="password" id="pass-field" class="w-full bg-white border-2 border-stone-100 rounded-xl p-4 text-center text-2xl mb-4" placeholder="••••" onkeydown="if(event.key==='Enter') checkPass()">
            <button onclick="checkPass()" class="w-full brown-gradient text-white py-3 rounded-xl font-bold">Otwórz</button>
        </div>
    </div>

    <header class="p-6 pt-10 text-center bg-white border-b">
        <h1 class="serif text-3xl italic font-bold text-stone-800">Granatowa Piekarnia</h1>
    </header>

    <nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-md border-b flex justify-around shadow-sm overflow-x-auto no-scrollbar">
        <button onclick="st('starters', this)" class="nav-btn active px-4 py-4 text-[10px] uppercase font-black tracking-widest whitespace-nowrap">Zakwasy</button>
        <button onclick="st('kalk', this)" class="nav-btn px-4 py-4 text-[10px] uppercase font-black tracking-widest whitespace-nowrap">Pieczenie</button>
        <button onclick="st('recipes', this)" class="nav-btn px-4 py-4 text-[10px] uppercase font-black tracking-widest whitespace-nowrap">Wiedza</button>
        <button onclick="st('info', this)" class="nav-btn px-4 py-4 text-[10px] uppercase font-black tracking-widest whitespace-nowrap">Magazyn</button>
        <button onclick="st('gallery', this)" class="nav-btn px-4 py-4 text-[10px] uppercase font-black tracking-widest whitespace-nowrap">Galeria</button>
    </nav>

    <main class="max-w-md mx-auto p-4 space-y-6">
        <section id="starters" class="tab-content active space-y-4">
            </section>

        <section id="kalk" class="tab-content space-y-6">
            </section>

        <section id="recipes" class="tab-content space-y-4">
            <div class="accordion-item glass-card active">
                <button onclick="toggleAccordion(this)" class="w-full p-6 flex justify-between items-center text-left">
                    <h3 class="serif text-xl font-bold italic text-stone-800">Logistyka Słoików</h3>
                    <span class="plus-icon text-2xl">+</span>
                </button>
                <div class="accordion-content p-6 pt-0 border-t border-stone-50 text-sm space-y-4">
                    <div class="recipe-step">
                        <p class="font-bold text-stone-800 italic">Etap 1: Aktywacja (ok. 16:00)</p>
                        <p>Pobierz 30g bazy ze słoika nr 2. Dodaj 50g mąki i 50g wody (38°C). Wymieszaj w słoiku nr 1 i zostaw na blacie w temperaturze pokojowej na 4-6 godzin.</p>
                    </div>
                    <div class="recipe-step">
                        <p class="font-bold text-stone-800 italic">Etap 2: Pobranie (ok. 22:00)</p>
                        <p>1. Pobierz 115g aktywnego zakwasu ze słoika nr 1 do miski.</p>
                        <p>2. Całą pozostałość (R1) ze słoika nr 1 przełóż do słoika nr 2.</p>
                    </div>
                    <div class="recipe-step">
                        <p class="font-bold text-stone-800 italic">Etap 3: Święta Porcja (Słoik 2)</p>
                        <p>1. Wymieszaj starą bazę (R2) ze zrzutem (R1).</p>
                        <p>2. Wymierz z tego 20g ("Święta Porcja") i zostaw w słoiku nr 2</p>
                        <p>3. Resztę ze słoika nr 2 przełoż do słoika nr 3 (Zlewki).</p>
                    </div>
                    <div class="recipe-step">
                        <p class="font-bold text-stone-800 italic">Etap 4: Regeneracja Matki</p>
                        <p>1. Do 20g porcji w słoiku nr 2 dodaj 40g mąki i 40g wody (38°C).</p>
                        <p>2. Zostaw na 1 godzinę na blacie w temperaturze pokojowej, a potem schowaj do lodówki.</p>
                    </div>
                </div>
            </div>

            <div class="accordion-item glass-card">
                <button onclick="toggleAccordion(this)" class="w-full p-6 flex justify-between items-center text-left">
                    <h3 class="serif text-xl font-bold italic text-stone-800">Przepis: Chleb</h3>
                    <span class="plus-icon text-2xl">+</span>
                </button>
                <div class="accordion-content p-6 pt-0 border-t border-stone-50 text-sm space-y-4 text-stone-600">
                    <div class="recipe-step">
                        <p class="font-bold text-stone-800 italic">Mieszanie (ok. 22:00)</p>
                        <p>Zrób zawiesinę: woda 340g (30°C) + aktywny zakwas 115g. Do tego dodaj 500g mąki i 14g soli. Wymieszaj, przykryj miskę i zostaw na noc na blacie w temperaturze pokojowej.</p>
                    </div>
                    <div class="recipe-step">
                        <p class="font-bold text-stone-800 italic">Rano (05:30 - 06:00)</p>
                        <p>Włóż ciasto do lodówki (pod przykryciem).</p>
                    </div>
                    <div class="recipe-step">
                        <p class="font-bold text-stone-800 italic">Pieczenie (od 16:00)</p>
                        <p>Nagrzej piec z garnkiem żeliwnym do 235°C. Uformuj ciasto metodą "na kopertę" by stało się napięte, po czym natnij ostrym nożem lub żyletką. Gdy piekarnik się już nagrzeje, piecz 30 min pod przykryciem, a następnie zdejmij pokrywkę i piecz kolejne 15 min bez niej.</p>
                    </div>
                </div>
            </div>

            <div class="accordion-item glass-card">
                <button onclick="toggleAccordion(this)" class="w-full p-6 flex justify-between items-center text-left">
                    <h3 class="serif text-xl font-bold italic text-stone-800">Przepis: Żurek na zlewkach</h3>
                    <span class="plus-icon text-2xl">+</span>
                </button>
                <div class="accordion-content p-6 pt-0 border-t border-stone-50 text-sm space-y-4 text-stone-600">
                    <div class="recipe-step">
                        <p class="font-bold text-stone-800 italic text-stone-900">Składniki na wywar (2-2.5L):</p>
                        <ul class="list-disc ml-4 space-y-1 mt-1 text-stone-700">
                            <li>250-300g wędzonych żeberek</li>
                            <li>150g wędzonego boczku</li>
                            <li>2 marchewki, 1 pietruszka, kawałek selera</li>
                            <li>1 cebula (opalona nad ogniem)</li>
                            <li>3 liście laurowe, 5 ziaren ziela angielskiego</li>
                            <li>2 litry zimnej wody</li>
                        </ul>
                    </div>
                    <div class="recipe-step">
                        <p class="font-bold text-stone-800 italic">Krok 1: Wywar Mięsny</p>
                        <p>Do garnka włóż żeberka, boczek, warzywa i przyprawy. Zalej zimną wodą. Gotuj pod przykryciem na minimalnym ogniu przez ok. 2 godziny, aż mięso będzie bardzo miękkie.</p>
                    </div>
                    <div class="recipe-step">
                        <p class="font-bold text-stone-800 italic">Krok 2: Zakwaszanie (Zlewki)</p>
                        <p>Odlej szklankę gorącego wywaru i wymieszaj ją dokładnie z 400g zlewek ze słoika nr 3 (to zapewni brak grudek). Wlej zawiesinę do garnka, cały czas mieszając. Zagotuj.</p>
                    </div>
                    <div class="recipe-step">
                        <p class="font-bold text-stone-800 italic">Krok 3: Wykończenie</p>
                        <p>Dodaj 2-3 ząbki przeciśniętego czosnku i 2 łyżki majeranku. Dopraw solą i pieprzem. Na koniec zabiel 100ml śmietanki 30%. Podawaj z białą kiełbasą i jajkiem.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="info" class="tab-content space-y-5">
            </section>

        <section id="gallery" class="tab-content">
            <div id="gal-cont" class="grid grid-cols-2 gap-3"></div>
        </section>
    </main>

    <div id="viewer-modal">
        <div class="p-4 flex justify-between items-center text-white">
            <span id="carousel-info" class="text-xs font-bold opacity-70"></span>
            <button onclick="closeViewer()" class="text-3xl">&times;</button>
        </div>
        
        <div class="relative flex-1 overflow-hidden">
            <div id="carousel-track" class="carousel-track"></div>
            <button onclick="moveCarousel(-1)" class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/10 p-4 rounded-full text-white text-2xl">&lsaquo;</button>
            <button onclick="moveCarousel(1)" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/10 p-4 rounded-full text-white text-2xl">&rsaquo;</button>
        </div>

        <div id="thumb-strip" class="thumb-strip no-scrollbar"></div>
    </div>

    <script>
        const GALLERY_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRhwbnRbCBfN9LtC-cGPK_ZNLQBPwytrADlL2_WDAcmLrHFXa0TeDWfFkZsNy5Z4421hD1LJRR_kiQO/pub?gid=0&single=true&output=csv';
        let allGalleryData = [];
        let currentImgIndex = 0;

        async function fetchGallery() {
            try {
                const res = await fetch(GALLERY_URL); const txt = await res.text();
                allGalleryData = txt.split('\n').slice(1).map(r => {
                    const c = r.split(',').map(s => s.trim().replace(/^"|"$/g, ''));
                    return { date: c[1], starter: c[2], thumb: c[3], full: c[4] };
                });
                renderAlbums();
            } catch(e){}
        }

        function renderAlbums() {
            const cont = document.getElementById('gal-cont');
            cont.innerHTML = '';
            allGalleryData.forEach((i, idx) => {
                const d = document.createElement('div');
                d.className = "relative aspect-square rounded-2xl overflow-hidden shadow-sm cursor-pointer";
                d.onclick = () => openCarousel(idx);
                d.innerHTML = `
                    <img src="${i.thumb}" class="w-full h-full object-cover">
                    <div class="absolute bottom-0 inset-x-0 bg-black/60 backdrop-blur-sm p-3 text-white">
                        <p class="text-[8px] uppercase font-bold opacity-70 mb-0.5">${i.starter}</p>
                        <p class="text-xs font-black tracking-wider">${i.date}</p>
                    </div>
                `;
                cont.appendChild(d);
            });
        }

        function openCarousel(idx) {
            currentImgIndex = idx;
            const modal = document.getElementById('viewer-modal');
            const track = document.getElementById('carousel-track');
            const thumbs = document.getElementById('thumb-strip');
            
            track.innerHTML = allGalleryData.map(img => `
                <div class="carousel-slide"><img src="${img.full}" class="max-w-full max-h-full object-contain shadow-2xl"></div>
            `).join('');

            thumbs.innerHTML = allGalleryData.map((img, i) => `
                <img src="${img.thumb}" onclick="goToSlide(${i})" class="thumb-item ${i === idx ? 'active' : ''}">
            `).join('');

            modal.classList.add('active');
            updateCarouselPosition();
        }

        function moveCarousel(dir) {
            currentImgIndex = (currentImgIndex + dir + allGalleryData.length) % allGalleryData.length;
            updateCarouselPosition();
        }

        function goToSlide(idx) {
            currentImgIndex = idx;
            updateCarouselPosition();
        }

        function updateCarouselPosition() {
            document.getElementById('carousel-track').style.transform = `translateX(-${currentImgIndex * 100}%)`;
            document.getElementById('carousel-info').innerText = `${allGalleryData[currentImgIndex].date} (${currentImgIndex + 1}/${allGalleryData.length})`;
            
            document.querySelectorAll('.thumb-item').forEach((t, i) => {
                t.classList.toggle('active', i === currentImgIndex);
            });
        }

        function closeViewer() { document.getElementById('viewer-modal').classList.remove('active'); }
        function st(id, btn) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active'); btn.classList.add('active');
            if(id === 'gallery' && allGalleryData.length === 0) fetchGallery();
        }
        function toggleAccordion(btn) { btn.parentElement.classList.toggle('active'); }
        function checkPass() { if(document.getElementById('pass-field').value === 'TWOJE_HASLO') document.getElementById('lock-screen').style.display='none'; }
    </script>
</body>
</html>
